<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0A0A0A">
    <title>Fordonsbok - Digital Servicebok</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="bgCanvas"></canvas>
    <!-- Auth Screen -->
    <div id="authScreen">
        <div class="auth-box">
            <div style="display:flex; justify-content:flex-end; margin-bottom:16px;">
                <div data-i18n-selector></div>
            </div>
            <h1 data-i18n="app.title">Fordonsbok</h1>
            <p class="subtitle" data-i18n="app.subtitle">Digital Servicehistorik</p>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')" data-i18n="auth.tabLogin">Inloggning</button>
                <button class="auth-tab" onclick="switchAuthTab('register')" data-i18n="auth.tabRegister">Skapa konto</button>
            </div>

            <div id="authError" class="error-message" style="display: none;"></div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label data-i18n="auth.labelEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="din@email.se">
                </div>
                <div class="form-group">
                    <label data-i18n="auth.labelPassword">L√∂senord</label>
                    <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div style="text-align: right; margin-bottom: 15px;">
                    <a href="#" onclick="event.preventDefault(); forgotPassword();" style="color: var(--accent-yellow); font-size: 0.85rem; text-decoration: none;" data-i18n="auth.forgotPassword">Gl√∂mt l√∂senord?</a>
                </div>
                <button type="submit" id="loginBtn" data-i18n="auth.loginBtn">Logga in</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label data-i18n="auth.labelEmail">Email</label>
                    <input type="email" id="registerEmail" required placeholder="din@email.se">
                </div>
                <div class="form-group">
                    <label data-i18n="auth.labelPasswordMin">L√∂senord (minst 6 tecken)</label>
                    <input type="password" id="registerPassword" required minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label data-i18n="auth.labelConfirmPwd">Bekr√§fta l√∂senord</label>
                    <input type="password" id="registerPasswordConfirm" required minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" id="registerBtn" data-i18n="auth.registerBtn">Skapa konto</button>
            </form>
        </div>
    </div>

    <!-- App Screen -->
    <div id="appScreen">
        <div class="container">
            <header>
                <div class="header-left">
                    <h1 data-i18n="app.title">Fordonsbok</h1>
                    <p class="subtitle" data-i18n="app.subtitle">Digital Servicehistorik</p>
                </div>
                <div class="header-right">
                    <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:flex-end;">
                        <div data-i18n-selector></div>
                        <div class="user-info">
                            <span data-i18n="header.loggedInAs">Inloggad som:</span> <span class="user-email" id="userEmail"></span>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="handleLogout()" data-i18n="header.logoutBtn">Logga ut</button>
                </div>
            </header>

            <div class="controls">
                <button onclick="openAddVehicleModal()" data-i18n="controls.addVehicle">+ L√§gg till fordon</button>
                <button class="secondary" onclick="exportData()" data-i18n="controls.exportData">Exportera data</button>
                <button class="secondary" onclick="openSwish()" style="background: rgba(255,100,0,0.2); border-color: rgba(255,100,0,0.5); color: #ff9d4d;" data-i18n="controls.buyCoffee">‚òï K√∂p en kaffe</button>
            </div>

            <div id="vehiclesContainer" class="vehicles-grid">
                <div class="loading">Laddar fordon</div>
            </div>
        </div>
    </div>

    <!-- Add Vehicle Modal -->
    <div id="addVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nytt Fordon</h2>
                <button class="close-btn" onclick="closeModal('addVehicleModal')">&times;</button>
            </div>
            <form id="addVehicleForm" onsubmit="addVehicle(event)">
                <div class="form-group">
                    <label>Registreringsnummer *</label>
                    <input type="text" id="regNumber" required placeholder="ABC123">
                </div>
                <div class="form-group">
                    <label>M√§rke *</label>
                    <select id="make" required onchange="updateModelOptions()">
                        <option value="">V√§lj m√§rke</option>
                        <option value="Audi">Audi</option>
                        <option value="BMW">BMW</option>
                        <option value="Citro√´n">Citro√´n</option>
                        <option value="Cupra">Cupra</option>
                        <option value="Dacia">Dacia</option>
                        <option value="Fiat">Fiat</option>
                        <option value="Ford">Ford</option>
                        <option value="Honda">Honda</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Jaguar">Jaguar</option>
                        <option value="Jeep">Jeep</option>
                        <option value="Kia">Kia</option>
                        <option value="Land Rover">Land Rover</option>
                        <option value="Lexus">Lexus</option>
                        <option value="Mazda">Mazda</option>
                        <option value="Mercedes-Benz">Mercedes-Benz</option>
                        <option value="MINI">MINI</option>
                        <option value="Mitsubishi">Mitsubishi</option>
                        <option value="Nissan">Nissan</option>
                        <option value="Opel">Opel</option>
                        <option value="Peugeot">Peugeot</option>
                        <option value="Polestar">Polestar</option>
                        <option value="Porsche">Porsche</option>
                        <option value="Renault">Renault</option>
                        <option value="Saab">Saab</option>
                        <option value="SEAT">SEAT</option>
                        <option value="≈†koda">≈†koda</option>
                        <option value="Subaru">Subaru</option>
                        <option value="Suzuki">Suzuki</option>
                        <option value="Tesla">Tesla</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="Volvo">Volvo</option>
                        <option value="Annat">Annat</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Modell *</label>
                    <select id="model" required>
                        <option value="">V√§lj f√∂rst ett m√§rke</option>
                    </select>
                </div>
                <div class="form-group" id="customModelGroup" style="display: none;">
                    <label>Ange modell</label>
                    <input type="text" id="customModel" placeholder="Skriv modellnamn">
                </div>
                <div class="form-group">
                    <label>√Örsmodell</label>
                    <input type="number" id="year" placeholder="2020">
                </div>
                <div class="form-group">
                    <label>F√§rg</label>
                    <input type="text" id="color" placeholder="Svart">
                </div>
                <div class="form-group">
                    <label>Anteckningar</label>
                    <textarea id="notes" placeholder="√ñvrig information om fordonet..."></textarea>
                </div>
                <div class="form-group">
                    <label>Foto av fordonet</label>
                    <input type="file" id="vehiclePhoto" accept="image/*" style="display: none;" onchange="document.getElementById('vehiclePhotoName').textContent = this.files[0]?.name || ''">
                    <label for="vehiclePhoto" style="display: block; width: 100%; padding: 12px; background: rgba(255,165,0,0.2); border: 2px dashed rgba(255,165,0,0.4); color: var(--accent-yellow); cursor: pointer; font-size: 1rem; text-align: center; border-radius: 5px;">
                        üì∑ V√§lj bild
                    </label>
                    <div id="vehiclePhotoName" style="margin-top: 8px; font-size: 0.85rem; color: var(--success);"></div>
                    <div id="photoPreview" style="margin-top: 10px; display: none;">
                        <img id="previewImage" style="max-width: 100%; max-height: 200px; border: 2px solid var(--border);" />
                    </div>
                </div>
                <button type="submit" id="addVehicleBtn">Spara fordon</button>
            </form>
        </div>
    </div>

    <!-- Vehicle Details Modal -->
    <div id="vehicleDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailsVehicleTitle"></h2>
                <button class="close-btn" onclick="closeModal('vehicleDetailsModal')" style="font-size: 2rem; padding: 5px 15px; min-width: 50px; min-height: 50px;">&times;</button>
            </div>
            <button onclick="closeModal('vehicleDetailsModal')" style="width: 100%; padding: 15px; margin-bottom: 15px; background: rgba(255,50,50,0.2); border: 2px solid rgba(255,50,50,0.4); color: #ff6464; font-size: 1.1rem; cursor: pointer;">‚úï St√§ng servicebok</button>
            <div id="vehicleDetailsContent"></div>
            <div style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">
                <button onclick="openAddServiceModal()">+ L√§gg till service</button>
                <button class="secondary" onclick="shareVehicle()" style="background: rgba(0,150,255,0.2); border-color: rgba(0,150,255,0.5); color: #4db8ff;">üîó Dela servicebok</button>
                <button class="secondary" onclick="exportPDF()" style="background: rgba(0,200,100,0.2); border-color: rgba(0,200,100,0.5); color: #00c864;">üìÑ Exportera PDF</button>
                <button class="secondary" onclick="openSellVehicleModal()" style="background: rgba(255,50,50,0.2); border-color: rgba(255,50,50,0.5); color: #ff6464;">ü§ù S√§lj / √ñverl√•t</button>
            </div>
            <div id="shareResult" style="display:none; margin-top: 15px; padding: 15px; background: rgba(0,150,255,0.1); border: 1px solid rgba(0,150,255,0.3); font-size: 0.85rem;">
                <p style="margin-bottom: 8px; color: #4db8ff;">üîó Delningsl√§nk (giltig 30 dagar):</p>
                <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                    <input id="shareUrl" type="text" readonly style="flex: 1; font-size: 0.75rem; padding: 8px; background: rgba(0,0,0,0.5); color: white; border: 1px solid rgba(0,150,255,0.3);">
                    <button onclick="copyShareLink()" style="padding: 8px 12px; font-size: 0.75rem; width: auto; clip-path: none;">Kopiera</button>
                </div>
                <p style="margin-top: 8px; color: var(--text-secondary); font-size: 0.75rem;">Mottagaren kan se serviceboken utan att logga in. L√§nken l√•ser inte boken.</p>
            </div>
            <div class="service-list">
                <h3 style="margin-bottom: 20px; color: var(--accent-yellow);">Servicehistorik</h3>
                <div id="serviceListContainer"></div>
            </div>
            <div style="margin-top: 30px; text-align: center;">
                <button onclick="closeModal('vehicleDetailsModal')" style="padding: 12px 40px; background: rgba(100,100,100,0.3); border-color: rgba(150,150,150,0.5); color: white;">‚Üê Tillbaka</button>
            </div>
        </div>
    </div>

    <!-- Sell Vehicle Modal -->
    <div id="sellVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ü§ù S√§lj / √ñverl√•t fordon</h2>
                <button class="close-btn" onclick="closeModal('sellVehicleModal')">&times;</button>
            </div>
            <div style="background: rgba(255,50,50,0.1); border: 1px solid rgba(255,50,50,0.3); padding: 15px; margin-bottom: 20px; font-size: 0.85rem;">
                <strong style="color: #ff6464;">‚ö†Ô∏è OBS! Detta kan inte √•ngras!</strong><br>
                <span style="color: var(--text-secondary);">All befintlig servicehistorik l√•ses permanent. Ny √§gare kan inte √§ndra eller ta bort historiken - bara l√§gga till nya poster.</span>
            </div>
            <div class="form-group">
                <label>Ny √§gares e-postadress</label>
                <input type="email" id="newOwnerEmail" placeholder="nyagare@email.se (l√§mna tomt om ok√§nd)">
                <p style="font-size: 0.78rem; color: var(--text-secondary); margin-top: 5px;">L√§mna tomt om du s√•lt bilen men k√∂paren inte anv√§nder Fordonsbok.</p>
            </div>
            <div class="form-group">
                <label>√ñverl√•telsedatum *</label>
                <input type="date" id="transferDate" required>
            </div>
            <div class="form-group">
                <label>F√∂rs√§ljningspris (kr)</label>
                <input type="number" id="transferPrice" placeholder="250000">
            </div>
            <div class="form-group">
                <label>Meddelande till ny √§gare</label>
                <textarea id="transferNote" placeholder="T.ex. servicar nyligen utf√∂rda, k√§nda fel..."></textarea>
            </div>
            <button id="confirmSellBtn" onclick="sellVehicle()" style="background: rgba(255,50,50,0.3); border-color: rgba(255,50,50,0.6);">ü§ù Bekr√§fta √∂verl√•telse</button>
        </div>
    </div>

    <!-- Read-only share view (shown when visiting share link) -->
    <div id="shareViewScreen" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background: var(--bg-main); z-index: 9999; overflow-y: auto; padding: 20px;">
        <div style="max-width: 800px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-family: 'Archivo Black'; font-size: 2rem; background: linear-gradient(135deg, var(--primary), var(--accent-yellow)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">FORDONSBOK</h1>
                <p style="color: var(--text-secondary); font-size: 0.8rem;">üëÅÔ∏è Skrivskyddad vy - delad servicebok</p>
            </div>
            <div id="shareViewContent"></div>
            <div style="text-align: center; margin-top: 30px; padding: 20px; border: 1px solid var(--border);">
                <p style="color: var(--text-secondary); font-size: 0.85rem;">Vill du spara din egen servicebok?</p>
                <a href="/" style="color: var(--primary);">Registrera dig gratis ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- Edit Vehicle Modal -->
    <div id="editVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="editVehicle.modalTitle">Redigera Fordon</h2>
                <button class="close-btn" onclick="closeModal('editVehicleModal')">&times;</button>
            </div>
            <form id="editVehicleForm" onsubmit="updateVehicle(event)">
                <input type="hidden" id="editVehicleId">
                <div class="form-group">
                    <label>Registreringsnummer *</label>
                    <input type="text" id="editRegNumber" required placeholder="ABC123">
                </div>
                <div class="form-group">
                    <label>M√§rke *</label>
                    <select id="editMake" required onchange="updateEditModelOptions()">
                        <option value="">V√§lj m√§rke</option>
                        <option value="Audi">Audi</option>
                        <option value="BMW">BMW</option>
                        <option value="Citro√´n">Citro√´n</option>
                        <option value="Cupra">Cupra</option>
                        <option value="Dacia">Dacia</option>
                        <option value="Fiat">Fiat</option>
                        <option value="Ford">Ford</option>
                        <option value="Honda">Honda</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Jaguar">Jaguar</option>
                        <option value="Jeep">Jeep</option>
                        <option value="Kia">Kia</option>
                        <option value="Land Rover">Land Rover</option>
                        <option value="Lexus">Lexus</option>
                        <option value="Mazda">Mazda</option>
                        <option value="Mercedes-Benz">Mercedes-Benz</option>
                        <option value="MINI">MINI</option>
                        <option value="Mitsubishi">Mitsubishi</option>
                        <option value="Nissan">Nissan</option>
                        <option value="Opel">Opel</option>
                        <option value="Peugeot">Peugeot</option>
                        <option value="Polestar">Polestar</option>
                        <option value="Porsche">Porsche</option>
                        <option value="Renault">Renault</option>
                        <option value="Saab">Saab</option>
                        <option value="SEAT">SEAT</option>
                        <option value="≈†koda">≈†koda</option>
                        <option value="Subaru">Subaru</option>
                        <option value="Suzuki">Suzuki</option>
                        <option value="Tesla">Tesla</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="Volvo">Volvo</option>
                        <option value="Annat">Annat</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Modell *</label>
                    <select id="editModel" required>
                        <option value="">V√§lj f√∂rst ett m√§rke</option>
                    </select>
                </div>
                <div class="form-group" id="editCustomModelGroup" style="display: none;">
                    <label data-i18n="addVehicle.labelCustomModel">Ange modell</label>
                    <input type="text" id="editCustomModel" placeholder="Skriv modellnamn">
                </div>
                <div class="form-group">
                    <label data-i18n="addVehicle.labelYear">√Örsmodell</label>
                    <input type="number" id="editYear" placeholder="2020">
                </div>
                <div class="form-group">
                    <label data-i18n="addVehicle.labelColor">F√§rg</label>
                    <input type="text" id="editColor" placeholder="Svart">
                </div>
                <div class="form-group">
                    <label data-i18n="addVehicle.labelNotes">Anteckningar</label>
                    <textarea id="editNotes" placeholder="√ñvrig information om fordonet..."></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="addVehicle.labelPhoto">Foto av fordonet</label>
                    <div id="editCurrentPhoto" style="margin-bottom: 10px;"></div>
                    <input type="file" id="editVehiclePhoto" accept="image/*" style="display: none;" onchange="document.getElementById('editVehiclePhotoName').textContent = this.files[0]?.name || ''">
                    <label for="editVehiclePhoto" style="display: block; width: 100%; padding: 12px; background: rgba(255,165,0,0.2); border: 2px dashed rgba(255,165,0,0.4); color: var(--accent-yellow); cursor: pointer; font-size: 1rem; text-align: center; border-radius: 5px;">
                        <span data-i18n="editVehicle.changePhoto">üì∑ V√§lj ny bild</span>
                    </label>
                    <div id="editVehiclePhotoName" style="margin-top: 8px; font-size: 0.85rem; color: var(--success);"></div>
                    <div id="editPhotoPreview" style="margin-top: 10px; display: none;">
                        <img id="editPreviewImage" style="max-width: 100%; max-height: 200px; border: 2px solid var(--border);" />
                    </div>
                </div>
                <button type="submit" id="updateVehicleBtn" data-i18n="editVehicle.submitBtn">Uppdatera fordon</button>
            </form>
        </div>
    </div>

    <!-- Add Service Modal -->
    <div id="addServiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="addService.modalTitle">Ny Service</h2>
                <button class="close-btn" onclick="closeModal('addServiceModal')">&times;</button>
            </div>
            <form id="addServiceForm" onsubmit="addService(event)">
                <div class="form-group">
                    <label data-i18n="addService.labelDate">Datum *</label>
                    <input type="date" id="serviceDate" required>
                </div>
                <div class="form-group">
                    <label data-i18n="addService.labelType">Typ av service *</label>
                    <select id="serviceType" required>
                        <option value="">V√§lj typ</option>
                        <option value="Ordinarie service">Ordinarie service</option>
                        <option value="Stora servicen">Stora servicen</option>
                        <option value="Oljebyte">Oljebyte</option>
                        <option value="Oljep√•fyllning">Oljep√•fyllning</option>
                        <option value="Bromsar">Bromsar</option>
                        <option value="Bromsv√§tsketoppning">Bromsv√§tsketoppning</option>
                        <option value="D√§ck">D√§ck</option>
                        <option value="D√§ckbyte">D√§ckbyte (sommar/vinter)</option>
                        <option value="Batteribyte">Batteribyte</option>
                        <option value="Gl√∂dlampor">Gl√∂dlampor</option>
                        <option value="Luftfilter">Luftfilter</option>
                        <option value="Kup√©filter">Kup√©filter</option>
                        <option value="Spolarv√§tska">Spolarv√§tska</option>
                        <option value="Kylv√§tska">Kylv√§tska</option>
                        <option value="Torkarblad">Torkarblad</option>
                        <option value="Reparation">Reparation</option>
                        <option value="Besiktning">Besiktning</option>
                        <option value="Tv√§tt/v√•rd">Tv√§tt/v√•rd</option>
                        <option value="√ñvrigt">√ñvrigt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="addService.labelMileage">M√§tarst√§llning (km)</label>
                    <input type="number" id="mileage" placeholder="15000">
                </div>
                <div class="form-group">
                    <label data-i18n="addService.labelPerformedBy">Utf√∂rt av *</label>
                    <select id="performedBy" required onchange="toggleWorkshopField()">
                        <option value="">V√§lj</option>
                        <option value="self" data-i18n="addService.selfOption">Sj√§lv (eget arbete)</option>
                        <option value="workshop" data-i18n="addService.workshopOption">Verkstad</option>
                    </select>
                </div>
                <div class="form-group" id="workshopGroup" style="display: none;">
                    <label data-i18n="addService.labelWorkshop">Verkstad</label>
                    <input type="text" id="workshop" placeholder="Bilverkstan AB">
                </div>
                <div class="form-group">
                    <label data-i18n="addService.labelCost">Kostnad (kr)</label>
                    <input type="number" id="cost" placeholder="2500">
                </div>
                <div class="form-group">
                    <label data-i18n="addService.labelNotes">Anteckningar</label>
                    <textarea id="serviceNotes" placeholder="Beskrivning av utf√∂rd service..."></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="addService.labelReceipt">Ladda upp kvitto (bild/PDF)</label>
                    <input type="file" id="serviceReceipt" accept="image/*,.pdf" style="display: none;" onchange="document.getElementById('serviceReceiptName').textContent = this.files[0]?.name || ''">
                    <label for="serviceReceipt" style="display: block; width: 100%; padding: 12px; background: rgba(255,165,0,0.2); border: 2px dashed rgba(255,165,0,0.4); color: var(--accent-yellow); cursor: pointer; font-size: 1rem; text-align: center; border-radius: 5px;">
                        <span data-i18n="addService.chooseReceipt">üßæ V√§lj kvitto</span>
                    </label>
                    <div id="serviceReceiptName" style="margin-top: 8px; font-size: 0.85rem; color: var(--success);"></div>
                    <div id="receiptPreview" style="margin-top: 10px; display: none;">
                        <img id="receiptPreviewImage" style="max-width: 100%; max-height: 150px; border: 2px solid var(--border);" />
                    </div>
                </div>
                <button type="submit" id="addServiceBtn" data-i18n="addService.submitBtn">Spara service</button>
            </form>
        </div>
    </div>

    <!-- Edit Service Modal -->
    <div id="editServiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="editService.modalTitle">Redigera Service</h2>
                <button class="close-btn" onclick="closeModal('editServiceModal')">&times;</button>
            </div>
            <form id="editServiceForm" onsubmit="updateService(event)">
                <input type="hidden" id="editServiceId">
                <div class="form-group">
                    <label data-i18n="editService.labelDate">Datum *</label>
                    <input type="date" id="editServiceDate">
                </div>
                <div class="form-group">
                    <label data-i18n="editService.labelType">Typ av service *</label>
                    <select id="editServiceType">
                        <option value="">V√§lj typ</option>
                        <option value="Ordinarie service">Ordinarie service</option>
                        <option value="Stora servicen">Stora servicen</option>
                        <option value="Oljebyte">Oljebyte</option>
                        <option value="Oljep√•fyllning">Oljep√•fyllning</option>
                        <option value="Bromsar">Bromsar</option>
                        <option value="Bromsv√§tsketoppning">Bromsv√§tsketoppning</option>
                        <option value="D√§ck">D√§ck</option>
                        <option value="D√§ckbyte">D√§ckbyte (sommar/vinter)</option>
                        <option value="Batteribyte">Batteribyte</option>
                        <option value="Gl√∂dlampor">Gl√∂dlampor</option>
                        <option value="Luftfilter">Luftfilter</option>
                        <option value="Kup√©filter">Kup√©filter</option>
                        <option value="Spolarv√§tska">Spolarv√§tska</option>
                        <option value="Kylv√§tska">Kylv√§tska</option>
                        <option value="Torkarblad">Torkarblad</option>
                        <option value="Reparation">Reparation</option>
                        <option value="Besiktning">Besiktning</option>
                        <option value="Tv√§tt/v√•rd">Tv√§tt/v√•rd</option>
                        <option value="√ñvrigt">√ñvrigt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="editService.labelMileage">M√§tarst√§llning (km)</label>
                    <input type="number" id="editServiceMileage" placeholder="15000">
                </div>
                <div class="form-group">
                    <label data-i18n="editService.labelPerformedBy">Utf√∂rt av *</label>
                    <select id="editPerformedBy" onchange="toggleEditWorkshopField()">
                        <option value="">V√§lj</option>
                        <option value="self" data-i18n="editService.selfOption">Sj√§lv (eget arbete)</option>
                        <option value="workshop" data-i18n="editService.workshopOption">Verkstad</option>
                    </select>
                </div>
                <div class="form-group" id="editWorkshopGroup" style="display: none;">
                    <label data-i18n="editService.labelWorkshop">Verkstad</label>
                    <input type="text" id="editWorkshop" placeholder="Bilverkstan AB">
                </div>
                <div class="form-group">
                    <label data-i18n="editService.labelCost">Kostnad (kr)</label>
                    <input type="number" id="editServiceCost" placeholder="2500">
                </div>
                <div class="form-group">
                    <label data-i18n="editService.labelNotes">Anteckningar</label>
                    <textarea id="editServiceNotes" placeholder="Beskrivning av utf√∂rd service..."></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="editService.labelNewReceipt">Ladda upp nytt kvitto (ers√§tter befintligt)</label>
                    <div id="editCurrentReceipt" style="margin-bottom: 10px;"></div>
                    <input type="file" id="editServiceReceipt" accept="image/*,.pdf" style="display: none;" onchange="document.getElementById('editServiceReceiptName').textContent = this.files[0]?.name || ''">
                    <label for="editServiceReceipt" style="display: block; width: 100%; padding: 12px; background: rgba(255,165,0,0.2); border: 2px dashed rgba(255,165,0,0.4); color: var(--accent-yellow); cursor: pointer; font-size: 1rem; text-align: center; border-radius: 5px;">
                        <span data-i18n="editService.chooseNewReceipt">üßæ V√§lj nytt kvitto</span>
                    </label>
                    <div id="editServiceReceiptName" style="margin-top: 8px; font-size: 0.85rem; color: var(--success);"></div>
                    <div id="editReceiptPreview" style="margin-top: 10px; display: none;">
                        <img id="editReceiptPreviewImage" style="max-width: 100%; max-height: 150px; border: 2px solid var(--border);" />
                    </div>
                </div>
                <button type="button" id="updateServiceBtn" onclick="updateService(event)" style="width: 100%; margin-top: 10px;" data-i18n="editService.updateBtn">Uppdatera service</button>
            </form>
        </div>
    </div>

    <!-- Receipt Viewer Modal -->
    <div id="receiptModal" class="modal">
        <div class="modal-content" style="max-width: 90%; max-height: 90vh;">
            <div class="modal-header">
                <h2>üßæ Kvitto</h2>
                <button class="close-btn" onclick="closeModal('receiptModal')">&times;</button>
            </div>
            <div style="overflow: auto; max-height: 75vh;">
                <img id="receiptImage" style="max-width: 100%; height: auto;" />
                <iframe id="receiptPDF" style="width: 100%; height: 70vh; border: none; display: none;"></iframe>
            </div>
        </div>
    </div>


    <!-- Firebase SDK (modular) -->
    <script type="module" src="script.js"></script>
    <!-- i18n + currency selector (must be module, loaded before script.js uses it) -->
    <script type="module" src="LanguageCurrencySelector.js"></script>
    <!-- Background canvas animation -->
    <script src="canvas.js"></script>
</body>
</html>
