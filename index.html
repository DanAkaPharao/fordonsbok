<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0A0A0A">
    <title>Fordonsbok - Digital Servicebok</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="bgCanvas"></canvas>

    <!-- ===================== AUTH SCREEN ===================== -->
    <div id="authScreen">
        <div class="auth-box">
            <h1>Fordonsbok</h1>
            <p class="subtitle">Digital Servicehistorik</p>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Logga in</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Registrera</button>
            </div>

            <div id="authError" class="error-message" style="display: none;"></div>

            <!-- Login -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="din@email.se">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Lösenord</label>
                    <input type="password" id="loginPassword" required placeholder="••••••">
                </div>
                <button type="submit" style="width:100%;margin-bottom:10px">Logga in</button>
                <button type="button" class="secondary" style="width:100%;font-size:0.8rem" onclick="handleForgotPassword()">Glömt lösenord?</button>
            </form>

            <!-- Register -->
            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required placeholder="din@email.se">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Lösenord (minst 6 tecken)</label>
                    <input type="password" id="registerPassword" required placeholder="••••••">
                </div>
                <div class="form-group">
                    <label for="registerConfirm">Bekräfta lösenord</label>
                    <input type="password" id="registerConfirm" required placeholder="••••••">
                </div>
                <button type="submit" style="width:100%">Skapa konto</button>
            </form>
        </div>
    </div>

    <!-- ===================== APP SCREEN ===================== -->
    <div id="appScreen">
        <div class="container">
            <header>
                <div class="header-left">
                    <h1>Fordonsbok</h1>
                    <p class="subtitle">Digital Servicehistorik</p>
                </div>
                <div class="header-right">
                    <div class="user-info">Inloggad som: <span class="user-email" id="userEmail"></span></div>
                    <button class="logout-btn" onclick="handleLogout()">Logga ut</button>
                </div>
            </header>

            <div class="controls">
                <button onclick="openAddVehicleModal()">+ Lägg till fordon</button>
                <button class="secondary" onclick="exportData()">Exportera data</button>
                <button class="secondary" onclick="openSwishModal()">☕ Köp en kaffe</button>
            </div>

            <div class="vehicles-grid" id="vehiclesList">
                <div class="loading">Laddar fordon</div>
            </div>
        </div>
    </div>

    <!-- ===================== MODAL: Nytt fordon ===================== -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="vehicleModalTitle">Nytt Fordon</h2>
                <button class="close-btn" onclick="closeVehicleModal()">✕</button>
            </div>
            <form id="vehicleForm" onsubmit="handleVehicleSubmit(event)">
                <div class="form-group">
                    <label for="vehicleReg">Registreringsnummer *</label>
                    <input type="text" id="vehicleReg" required placeholder="ABC123">
                </div>
                <div class="form-group">
                    <label for="vehicleBrand">Märke *</label>
                    <select id="vehicleBrand" required>
                        <option value="">Välj märke</option>
                        <option>Audi</option><option>BMW</option><option>Citroën</option>
                        <option>Cupra</option><option>Dacia</option><option>Fiat</option>
                        <option>Ford</option><option>Honda</option><option>Hyundai</option>
                        <option>Jaguar</option><option>Jeep</option><option>Kia</option>
                        <option>Land Rover</option><option>Lexus</option><option>Mazda</option>
                        <option>Mercedes-Benz</option><option>MINI</option><option>Mitsubishi</option>
                        <option>Nissan</option><option>Opel</option><option>Peugeot</option>
                        <option>Polestar</option><option>Porsche</option><option>Renault</option>
                        <option>Saab</option><option>SEAT</option><option>Škoda</option>
                        <option>Subaru</option><option>Suzuki</option><option>Tesla</option>
                        <option>Toyota</option><option>Volkswagen</option><option>Volvo</option>
                        <option>Annat</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="vehicleModel">Modell</label>
                    <input type="text" id="vehicleModel" placeholder="t.ex. Golf, 3-serie">
                </div>
                <div class="form-group">
                    <label for="vehicleYear">Årsmodell</label>
                    <input type="number" id="vehicleYear" placeholder="t.ex. 2020" min="1900" max="2099">
                </div>
                <div class="form-group">
                    <label for="vehicleMileage">Miltal (km)</label>
                    <input type="number" id="vehicleMileage" placeholder="t.ex. 50000">
                </div>
                <div class="form-group">
                    <label for="vehiclePhoto">Foto</label>
                    <input type="file" id="vehiclePhoto" accept="image/*" onchange="previewPhoto(this)">
                    <img id="vehiclePhotoPreview" style="display:none;width:100%;margin-top:10px;border:2px solid var(--border)">
                </div>
                <div class="form-group">
                    <label for="vehicleNotes">Anteckningar</label>
                    <textarea id="vehicleNotes" placeholder="Övrig info om fordonet..."></textarea>
                </div>
                <button type="submit" style="width:100%">Spara fordon</button>
            </form>
        </div>
    </div>

    <!-- ===================== MODAL: Servicehistorik ===================== -->
    <div id="serviceModal" class="modal">
        <div class="modal-content" style="max-width:700px">
            <div class="modal-header">
                <h2 id="serviceModalTitle">Servicehistorik</h2>
                <button class="close-btn" onclick="closeServiceModal()">✕</button>
            </div>
            <button onclick="openAddServiceModal()" style="margin-bottom:20px">+ Lägg till service</button>
            <div class="service-list" id="serviceList"></div>
        </div>
    </div>

    <!-- ===================== MODAL: Lägg till service ===================== -->
    <div id="addServiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ny Servicepost</h2>
                <button class="close-btn" onclick="closeAddServiceModal()">✕</button>
            </div>
            <form id="serviceForm" onsubmit="handleServiceSubmit(event)">
                <div class="form-group">
                    <label for="serviceTitle">Titel *</label>
                    <input type="text" id="serviceTitle" required placeholder="t.ex. Oljebyte, Däckbyte">
                </div>
                <div class="form-group">
                    <label for="serviceDate">Datum</label>
                    <input type="date" id="serviceDate">
                </div>
                <div class="form-group">
                    <label for="serviceMileage">Miltal vid service (km)</label>
                    <input type="number" id="serviceMileage" placeholder="t.ex. 55000">
                </div>
                <div class="form-group">
                    <label for="serviceWorkshop">Verkstad</label>
                    <input type="text" id="serviceWorkshop" placeholder="t.ex. Volvo Sundsvall">
                </div>
                <div class="form-group">
                    <label for="serviceCost">Kostnad (kr)</label>
                    <input type="number" id="serviceCost" placeholder="t.ex. 2500">
                </div>
                <div class="form-group">
                    <label for="serviceNotes">Anteckningar</label>
                    <textarea id="serviceNotes" placeholder="Vad gjordes? Delar som byttes etc."></textarea>
                </div>
                <button type="submit" style="width:100%">Spara servicepost</button>
            </form>
        </div>
    </div>

    <!-- ===================== MODAL: Swish ===================== -->
    <div id="swishModal" class="modal">
        <div class="modal-content swish-modal-content" style="max-width:400px;text-align:center">
            <div class="modal-header">
                <h2>☕ Köp en kaffe</h2>
                <button class="close-btn" onclick="closeSwishModal()">✕</button>
            </div>
            <p style="color:var(--text-secondary);margin-bottom:20px">Gillar du appen? Bjud mig på en kaffe via Swish!</p>
            <!-- Ersätt swish-qr.png med din QR-bild uppladdad i GitHub-repot -->
            <img src="swish-QR-large.png" alt="Swish QR-kod" class="swish-qr">
            <div class="swish-number">123-456 78 90</div>
            <p class="swish-description">Tack för ditt stöd! ❤️</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="script.js"></script>
</body>
</html>
